webpackJsonp([32],{Xoim:function(e,t){},yWh7:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("Xxa5"),s=i.n(a),r=i("exGp"),n=i.n(r),o=i("mvHQ"),l=i.n(o),c=i("gyMJ"),d={data:function(){return{contentTitle:"",ruleForm:{screen_name:"",frequency:"",screen_type:"",show_type:""},rules:{screen_type:[{required:!0,message:"请选择设备类型",trigger:"change"}],show_type:[{required:!0,message:"请选择素材类型",trigger:"change"}]},screenTypeList:[],showTypeList:[],playType:[],showTitle:"选择图片",showTypeVisible:!1,screenVisible:!1,nodeData:[],showNodeData:[],defaultProps:{children:"children",label:"device_name"},isSelectAll:!1,device_ids:[],screen:[],showType:[],tableHead:[{title:"素材名称",prop:"title",minWidth:"100"},{title:"素材时长",prop:"duration",minWidth:"100"}],tableHeight:window.innerHeight-180,total:0,page:1,pageSize:5,tableHeadCopy:[],baseUrl:"",keyword:"",file_ids:[],hash:"",previewData:[],infoId:"",dis:[],timestr:""}},mounted:function(){this.baseUrl="http://xwcs.xyruxue.com/",this.infoId=this.$route.params.id,this.$route.params.id&&this.getInfo(this.infoId),this.getHash(),this.resView(),this.tableHeadCopy=JSON.parse(l()(this.tableHead))},methods:{getRowKey:function(e){return e.id},videoClick:function(e){window.open(e,"_blank")},cellClick:function(e,t,i,a){2==e.file_type&&"right"==t.fixed&&window.open(this.baseUrl+e.file_path,"_blank")},handleSizeChange:function(e){this.page=1,this.pageSize=e,this.resView()},handleCurrentChange:function(e){this.page=e,this.resView()},selectAll:function(){this.isSelectAll?this.$refs.tree.setCheckedNodes(this.nodeData):this.$refs.tree.setCheckedNodes([])},screenClick:function(){var e=this;this.resView(),this.screenVisible=!0,this.isSelectAll=!1,this.$nextTick(function(){e.screen.length>0&&e.getNodeData(e.screen)})},getNodeData:function(e){var t=this;return n()(s.a.mark(function i(){var a,r,n;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return t.nodeData=[],a={device_type:"4",file_type:3,title:t.keyword},i.next=4,t.axios.post(c._0,a);case 4:1==(r=i.sent).data.code?(t.nodeData=r.data.data.device_list,e?t.$nextTick(function(){var t=this;this.$refs.tree.setCheckedKeys([]),e.forEach(function(e){var i=t.$refs.tree.getNode(e);i&&t.$refs.tree.setChecked(i,!0)})}):(n=[],t.nodeData.forEach(function(e){n.push(e.device_id),e.children&&e.children.forEach(function(e){n.push(e.device_id)})}),t.$nextTick(function(){this.$refs.tree.setCheckedKeys(n)}))):t.$message({showClose:!0,message:r.data.msg,type:"error"});case 6:case"end":return i.stop()}},i,t)}))()},linChange:function(e){var t=this;if(e.length>5)return this.$message({showClose:!0,message:"铃声素材最多选择五个",type:"error"}),void e.splice(4,e.length-5);this.previewData=[],e.forEach(function(e){t.showNodeData.forEach(function(i){e==i.id&&t.previewData.push(i)})});var i=0;this.previewData.forEach(function(e,t){void 0!==e&&(i+=e.file_length)}),this.timestr=this.timeChange(i)},showClick:function(){var e=this;this.keyword="",this.resView(),1==this.ruleForm.show_type?this.tableHead=this.tableHead.filter(function(e){return"素材时长"!==e.title}):this.tableHead=this.tableHeadCopy,this.showTypeVisible=!0,this.$nextTick(function(){e.previewData.forEach(function(t){void 0!==e.showNodeData.find(function(e){return e.id==t.id})&&e.$refs.multipleTable.toggleRowSelection(e.showNodeData.find(function(e){return e.id==t.id}),!0)})})},goBack:function(){this.$router.go(-1)},resView:function(){var e=this;return n()(s.a.mark(function t(){var i,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i={device_type:"4",file_type:3,title:e.keyword},t.next=3,e.axios.post(c._0,i);case 3:1==(a=t.sent).data.code?(e.nodeData=a.data.data.device_list,e.showNodeData="[object Object]"===Object.prototype.toString.call(a.data.data.file_list)?a.data.data.file_list.data:[],e.showTypeList=a.data.data.show_type_list):e.$message({showClose:!0,message:a.data.msg,type:"error"});case 5:case"end":return t.stop()}},t,e)}))()},resetForm:function(){var e=this;this.ruleForm={screen_name:"",frequency:"",screen_type:"",show_type:""},this.showType=[],this.screen=[],this.$nextTick(function(){e.$refs.ruleForm.resetFields()})},screenSubmit:function(){this.screen=this.$refs.tree.getCheckedKeys().concat(this.$refs.tree.getHalfCheckedKeys()),this.screenVisible=!1},submitForm:function(){var e,t=this;this.$refs.ruleForm.validate((e=n()(s.a.mark(function e(i){var a,r,n,o,l;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!i){e.next=14;break}return e.next=3,t.getHash();case 3:return a=new RegExp(/^[0-9]*$/),r=[],t.screen.forEach(function(e){a.test(e)&&r.push(e)}),n={rehearsal_id:JSON.parse(localStorage.getItem("Rehearsal_Id")),file_ids:t.dis.join(","),device_ids:r.join(","),hash:t.hash},o=void 0,void 0!==t.infoId?(o=c._83,n.id=t.infoId):o=c._80,e.next=12,t.axios.post(o,n);case 12:1==(l=e.sent).data.code?(t.$message({showClose:!0,message:l.data.msg,type:"success"}),t.$router.push("/drillManAdd")):t.$message({showClose:!0,message:l.data.msg,type:"error"});case 14:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},getHash:function(){var e=this;return n()(s.a.mark(function t(){var i,a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return i={page_hash:"multimediAdd"},t.next=3,e.axios.post(c._20,i);case 3:1==(a=t.sent).data.code?e.hash=a.data.data:e.$message({showClose:!0,message:a.data.msg,type:"error"});case 5:case"end":return t.stop()}},t,e)}))()},del:function(e,t){var i=this.file_ids.findIndex(function(t){return t==e.id});this.file_ids.splice(i,1),this.previewData.splice(t,1);var a=0;this.previewData.forEach(function(e,t){void 0!==e&&2==e.file_type&&(a+=e.file_length)}),this.timestr=this.timeChange(a)},getInfo:function(e){var t=this;return n()(s.a.mark(function i(){var a,r;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,t.axios.post(c._84,{id:e});case 2:1==(a=i.sent).data.code?(t.ruleForm=a.data.data,t.device_ids=a.data.data.list,t.screen=a.data.data.list,t.dis=a.data.data.file_ids.length>0?a.data.data.file_ids.split(","):[],t.previewData=a.data.data.file_data,r=0,t.previewData.forEach(function(e,t){void 0!==e&&(r+=e.file_length)}),t.timestr=t.timeChange(r),t.resView()):t.$message({showClose:!0,message:a.data.msg,type:"error"});case 4:case"end":return i.stop()}},i,t)}))()},timeChange:function(e){var t=parseInt(e),i=Math.floor(t/86400)<10?"0"+Math.floor(t/86400):Math.floor(t/86400),a=Math.floor(t/3600%24)<10?"0"+Math.floor(t/3600%24):Math.floor(t/3600%24),s=Math.floor(t/60%60)<10?"0"+Math.floor(t/60%60):Math.floor(t/60%60),r=Math.floor(t%60)<10?"0"+Math.floor(t%60):Math.floor(t%60),n="";return"00"!==i&&(n+=i+"天"),"00"!==a&&(n+=a+"时"),"00"!==s&&(n+=s+"分"),n+=r+"秒"}}},h={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"main"},[i("div",{staticClass:"school_check"},[i("el-page-header",{attrs:{content:e.contentTitle},on:{back:e.goBack}})],1),e._v(" "),i("div",{staticClass:"form_body"},[i("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[i("el-form-item",{attrs:{label:"设备选择"}},[i("el-button",{on:{click:e.screenClick}},[e._v("设备选择")])],1),e._v(" "),i("el-form-item",{attrs:{label:"选择素材"}},[i("el-select",{attrs:{multiple:"",size:"small",clearable:"",filterable:"",placeholder:"请选择素材"},on:{change:e.linChange},model:{value:e.dis,callback:function(t){e.dis=t},expression:"dis"}},e._l(e.showNodeData,function(e){return i("el-option",{key:e.id,attrs:{label:e.title,value:String(e.id)}})}),1)],1),e._v(" "),i("el-form-item",[e.previewData.length>0?i("div",[e._v("\n                    "+e._s("目前播放时长："+e.timestr)+"\n                ")]):e._e(),e._v(" "),e.previewData.length>0?i("div",[e._l(e.previewData,function(t,a){return[i("span",{key:a,staticStyle:{"margin-right":"10px"}},[i("el-link",{attrs:{underline:!1,target:"_blank",type:"primary",href:e.baseUrl+t.file_path}},[e._v(e._s(t.title+".mp3"))])],1)]}),e._v(" "),i("span")],2):e._e()]),e._v(" "),i("el-form-item",[i("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确 定")])],1)],1)],1),e._v(" "),i("el-dialog",{attrs:{title:"选择设备",visible:e.screenVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.screenVisible=t},close:function(t){e.screenVisible=!1}}},[i("el-form",[i("el-form-item",{staticStyle:{display:"block"}},[i("el-checkbox",{on:{change:e.selectAll},model:{value:e.isSelectAll,callback:function(t){e.isSelectAll=t},expression:"isSelectAll"}},[e._v("全选/全不选")]),e._v(" "),i("el-tree",{ref:"tree",attrs:{data:e.nodeData,"show-checkbox":"","check-on-click-node":"","node-key":"device_id",props:e.defaultProps}})],1),e._v(" "),i("el-form-item",[i("el-button",{on:{click:e.screenSubmit}},[e._v("提交")])],1)],1)],1)],1)},staticRenderFns:[]};var f=i("VU/8")(d,h,!1,function(e){i("Xoim")},"data-v-4cb42610",null);t.default=f.exports}});
//# sourceMappingURL=32.e559eccfd00905247e01.js.map