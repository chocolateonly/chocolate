webpackJsonp([42],{"1Uix":function(e,t){},"4w2k":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=a("Xxa5"),s=a.n(r),i=a("exGp"),o=a.n(i),n=a("bOdI"),l=a.n(n),d=a("gyMJ"),c={data:function(){var e;return e={formData:{role_name:"",remarks:"",role_grade:"",node_ids:"",disabled:0},method_auth:{actAdd:0,actEdit:0,actDelete:0,setState:0},tableHeight:window.innerHeight-180,title:"",listId:"",hash:"",dialogVisible:!1,tableHead:[{title:"编号",prop:"id",width:"100"},{title:"角色名",prop:"role_name",width:"300"},{title:"角色类型",prop:"role_type",width:"300"},{title:"描述",prop:"remarks"},{title:"状态",prop:"disabled"}],nodesData:[]},l()(e,"nodesData",[]),l()(e,"tableData",[]),l()(e,"purviewData",[]),l()(e,"rule",{role_name:[{required:!0,message:"请选择角色名称",trigger:"blur"}],role_grade:[{required:!0,message:"请选择权限范围",trigger:"change"}]}),l()(e,"defaultProps",l()({children:"children",label:"node_name",disabled:"defaulted"},"disabled","defaulted")),l()(e,"startOption",{}),l()(e,"rolesData",[]),l()(e,"defaulted",""),l()(e,"isLoading",!1),l()(e,"hasNodes",[]),l()(e,"dictionary_name",""),e},mounted:function(){this.getList()},methods:{resetForm:function(){this.formData={role_name:"",remarks:"",role_grade:"",node_ids:""},this.hasNodes=[]},addBtn:function(){this.title="新增",this.dialogVisible=!0,this.resetForm(),this.getNodeData(),this.getInfoData(),this.getHash()},editBtn:function(e){this.title="编辑",this.dialogVisible=!0,this.listId=e.id,this.getInfoData(e.id),this.getHash()},submitForm:function(e){var t,a=this;this.purviewData.forEach(function(e,t){e.dictionary_value==a.formData.role_grade&&(a.dictionary_name=a.purviewData[t].dictionary_name)}),this.$refs[e].validate((t=o()(s.a.mark(function e(t){var r,i,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=10;break}return r={disabled:a.formData.disabled,role_name:a.formData.role_name,node_ids:a.$refs.tree.getCheckedKeys().concat(a.$refs.tree.getHalfCheckedKeys()).join(","),remarks:a.formData.remarks,role_grade:a.formData.role_grade,role_type:a.dictionary_name,hash:a.hash},"新增"==a.title?i=d._85:"编辑"==a.title&&(i=d._87,r.id=a.listId),e.next=5,a.axios.post(i,r);case 5:1==(o=e.sent).data.code?(a.dialogVisible=!1,a.getList()):a.$message({showClose:!0,message:o.data.msg,type:"error"}),a.getHash(),e.next=12;break;case 10:return console.log("error submit!!"),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,a)})),function(e){return t.apply(this,arguments)}))},delBtn:function(e){var t=this;return o()(s.a.mark(function a(){return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:t.$confirm("是否删除该条数据?","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(o()(s.a.mark(function a(){var r,i;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r={id:e},a.next=3,t.axios.post(d._86,r);case 3:1==(i=a.sent).data.code?t.getList():t.$message({showClose:!0,message:i.data.msg,type:"error"}),t.getHash();case 6:case"end":return a.stop()}},a,t)}))).catch(function(){t.$message({type:"info",message:"已取消删除"})});case 1:case"end":return a.stop()}},a,t)}))()},getInfoData:function(e){var t=this;return o()(s.a.mark(function a(){var r,i;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r={id:e},a.next=3,t.axios.post(d._90,r);case 3:1==(i=a.sent).data.code?(t.nodesData=i.data.data.data,t.getRolesData(e)):t.$message({showClose:!0,message:i.data.msg,type:"error"});case 5:case"end":return a.stop()}},a,t)}))()},getRolesData:function(e){var t=this;return o()(s.a.mark(function a(){var r,i;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return r={role_id:e},a.next=3,t.axios.post(d._91,r);case 3:1==(i=a.sent).data.code?(t.hasNodes=i.data.data.nodes,t.$nextTick(function(){t.getNodeData(t.hasNodes)}),i.data.data.role&&(t.formData=i.data.data.role)):t.$message({showClose:!0,message:i.data.msg,type:"error"});case 5:case"end":return a.stop()}},a,t)}))()},getNodeData:function(e){var t=this;return o()(s.a.mark(function a(){var r,i;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.axios.post(d._89);case 2:1==(r=a.sent).data.code?(t.purviewData=r.data.data,t.purviewData.forEach(function(e){e.dictionary_value=Number(e.dictionary_value)}),e&&"编辑"==t.title?t.$nextTick(function(){var t=this;this.$refs.tree.setCheckedKeys([]),e.forEach(function(e){var a=t.$refs.tree.getNode(e);a&&a.isLeaf&&t.$refs.tree.setChecked(a,!0)})}):(i=[],t.nodesData.forEach(function(e){i.push(e.id),e.children&&e.children.forEach(function(e){i.push(e.id)})}),t.$nextTick(function(){this.$refs.tree.setCheckedKeys(i)}))):t.$message({showClose:!0,message:r.data.msg,type:"error"});case 4:case"end":return a.stop()}},a,t)}))()},getList:function(){var e=this;return o()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.isLoading=!0,t.next=3,e.axios.post(d._88,{});case 3:1==(a=t.sent).data.code?(e.tableData=a.data.data.data,e.defaulted=a.data.data.defaulted,e.isLoading=!1):(e.isLoading=!1,e.$message({showClose:!0,message:a.data.msg,type:"error"}));case 5:case"end":return t.stop()}},t,e)}))()},getHash:function(){var e=this;return o()(s.a.mark(function t(){var a,r;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={page_hash:"roleManagement"},t.next=3,e.axios.post(d._20,a);case 3:1==(r=t.sent).data.code?e.hash=r.data.data:e.$message({showClose:!0,message:r.data.msg,type:"error"});case 5:case"end":return t.stop()}},t,e)}))()}}},u={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("div",{staticClass:"roleManagement"},[a("div",{staticClass:"searchA"},[a("div",{staticClass:"add"},[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.addBtn}},[e._v("新增")])],1)]),e._v(" "),a("div",{staticClass:"home_table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","max-height":e.tableHeight,size:"medium"}},[e._l(e.tableHead,function(t,r){return["状态"==t.title?a("el-table-column",{key:r,attrs:{prop:t.prop,label:t.title,width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.disabled?a("span",{staticStyle:{color:"#409EFF"}},[e._v("启用")]):1==t.row.disabled?a("span",{staticStyle:{color:"#F56C6C"}},[e._v("禁用")]):e._e()]}}],null,!0)}):a("el-table-column",{key:r,attrs:{prop:t.prop,label:t.title,width:t.width,"show-overflow-tooltip":!0}})]}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"操作",fixed:"right",width:"150"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.editBtn(t.row)}}},[e._v("编辑")]),e._v(" "),1==e.defaulted?a("el-button",{staticStyle:{color:"#ff2b2b"},attrs:{type:"text",size:"small"},on:{click:function(a){return e.delBtn(t.row.id)}}},[e._v("删除")]):e._e()]}}])})],2)],1),e._v(" "),e.dialogVisible?a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:e.title,visible:e.dialogVisible,width:"700px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticStyle:{"padding-left":"20px"}},[a("el-form",{ref:"formData",attrs:{model:e.formData,rules:e.rule,"status-icon":"","label-position":"top","label-width":"100px",inline:!0}},[a("div",{staticClass:"dialogInput",staticStyle:{display:"flex"}},[a("div",{staticClass:"padd",staticStyle:{"margin-right":"10px"}},[a("el-form-item",{attrs:{label:"角色名称",prop:"role_name"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择角色名称",size:"small"},model:{value:e.formData.role_name,callback:function(t){e.$set(e.formData,"role_name",t)},expression:"formData.role_name"}})],1)],1),e._v(" "),a("div",{staticClass:"padd",staticStyle:{"margin-right":"10px"}},[a("el-form-item",{attrs:{label:"权限范围",prop:"role_grade"}},[a("el-select",{attrs:{placeholder:"请选择权限范围",size:"small",clearable:""},model:{value:e.formData.role_grade,callback:function(t){e.$set(e.formData,"role_grade",t)},expression:"formData.role_grade"}},e._l(e.purviewData,function(e){return a("el-option",{key:e.id,attrs:{label:e.dictionary_name,value:e.dictionary_value}})}),1)],1)],1),e._v(" "),a("div",{staticClass:"padd",staticStyle:{"margin-right":"10px"}},[a("el-form-item",{attrs:{label:"角色状态"}},[a("el-switch",{attrs:{"active-value":0,"inactive-value":1},model:{value:e.formData.disabled,callback:function(t){e.$set(e.formData,"disabled",t)},expression:"formData.disabled"}})],1)],1)]),e._v(" "),a("div",{staticClass:"dialogInput",staticStyle:{display:"flex"}},[a("div",{staticClass:"padd",staticStyle:{"margin-right":"10px"}},[a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"角色描述",prop:"remarks"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入角色描述（60个字符以内）",size:"small"},model:{value:e.formData.remarks,callback:function(t){e.$set(e.formData,"remarks",t)},expression:"formData.remarks"}})],1)],1)]),e._v(" "),a("div",{staticClass:"dialogInput"},[a("div",{staticClass:"padd"},[a("div",{staticClass:"paddTit"},[e._v("资源权限")]),e._v(" "),a("div",{staticClass:"tree_main"},[a("el-form-item",[a("el-tree",{ref:"tree",attrs:{data:e.nodesData,"show-checkbox":"","check-on-click-node":"","node-key":"id","default-expand-all":"",props:e.defaultProps}})],1)],1)])]),e._v(" "),a("div",{staticStyle:{"text-align":"center","margin-top":"20px"}},[a("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:function(t){return e.submitForm("formData")}}},[e._v("确 定")])],1)])],1)]):e._e()],1)])},staticRenderFns:[]};var m=a("VU/8")(c,u,!1,function(e){a("1Uix")},"data-v-19dfc153",null);t.default=m.exports}});
//# sourceMappingURL=42.fad1add88aad61a42fd6.js.map