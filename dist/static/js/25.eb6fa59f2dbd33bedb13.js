webpackJsonp([25],{JWku:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("mvHQ"),r=a.n(i),s=a("Xxa5"),n=a.n(s),l=a("exGp"),o=a.n(l),c=a("gyMJ"),u={data:function(){return{xdebug:"",keyword:"",scene:"",total:0,page:1,pageSize:15,tableData:[],tableHeight:window.innerHeight-180,status:"",hash:"",dialogVisible:!1,centerDialogVisible:!1,title:"",checked:!1,ruleForm:{id:"",list:[{user_id:"",task:""}],scene:"",scene_name:"",title:""},rules:{scene_name:[{required:!0,message:"请输入活动名称",trigger:"blur"}],region:[{required:!0,message:"请选择活动区域",trigger:"change"}],title:[{required:!0,message:"请选择活动区域",trigger:"change"}]},deviceType:[],ifStartMan:!0,startManText:"开始演练",formInline:{keyword:"",scene:""},tableHead:[{title:"序号",prop:"id",minWidth:"80"},{title:"演练名称",prop:"title",minWidth:"160"},{title:"场景",prop:"scene_name",minWidth:"120"},{title:"人员任务",prop:"people",minWidth:"120"},{title:"创建时间",prop:"create_time",minWidth:"160"},{title:"演练操作",prop:"operation",minWidth:"120"}],tableHeadTask:[{title:"序号",prop:"id",minWidth:"80"},{title:"参与人员",prop:"real_name",minWidth:"100"},{title:"人员任务",prop:"task",minWidth:"100"}],tableDataTask:[],task:{},drillList:[]}},created:function(){this.drillGetList(),this.getHash(),this.resView()},watch:{centerDialogVisible:function(e){e&&"编辑"===this.title&&this.getInfo()}},methods:{search:function(){this.page=1,this.drillGetList()},handleSizeChange:function(e){this.page=1,this.pageSize=e,this.drillGetList()},handleCurrentChange:function(e){this.page=e,this.drillGetList()},resView:function(){var e=this;return o()(n.a.mark(function t(){var a;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.axios.post(c._0);case 2:1==(a=t.sent).data.code?e.drillList=a.data.data.scene_list:e.$message({showClose:!0,message:a.data.msg,type:"error"});case 4:case"end":return t.stop()}},t,e)}))()},peopleClick:function(e){var t=this;this.dialogVisible=!0,this.tableDataTask=[],this.task={},this.$nextTick(function(){t.taskInfo(e.id)})},taskInfo:function(e){var t=this;return o()(n.a.mark(function a(){var i;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.axios.post(c._152,{id:e});case 2:1==(i=a.sent).data.code?(t.tableDataTask=i.data.data.list,t.task=i.data.data):t.$message({showClose:!0,message:i.data.msg,type:"error"});case 4:case"end":return a.stop()}},a,t)}))()},operationClick:function(e){var t=this;return o()(n.a.mark(function a(){var i,r;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i={id:e.id,state:1==e.status?0:1,hash:t.hash},a.next=3,t.axios.post(c.Z,i);case 3:1==(r=a.sent).data.code?t.$message({showClose:!0,message:r.data.msg,type:"success"}):t.$message({showClose:!0,message:r.data.msg,type:"error"}),t.getHash(),t.drillGetList();case 7:case"end":return a.stop()}},a,t)}))()},removeDomain:function(e){var t=this.ruleForm.list.indexOf(e);0!==t&&this.ruleForm.list.splice(t,1)},submitForm:function(){var e,t=this;this.$refs.ruleForm.validate((e=o()(n.a.mark(function e(a){var i,s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=15;break}return e.next=3,t.getHash();case 3:return i={XDEBUG_SESSION_START:t.xdebug,id:t.ruleForm.id,title:t.ruleForm.title,scene:t.ruleForm.scene,task_data:r()(t.ruleForm.list),hash:t.hash},e.next=6,t.axios.post(c.U,i);case 6:if(1!=(s=e.sent).data.code){e.next=14;break}return t.$message({showClose:!0,message:s.data.msg,type:"success"}),t.centerDialogVisible=!1,e.next=12,t.drillGetList();case 12:e.next=15;break;case 14:t.$message({showClose:!0,message:s.data.msg,type:"error"});case 15:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},addDomain:function(){this.ruleForm.list.push({user_id:"",task:""})},getHash:function(){var e=this;return o()(n.a.mark(function t(){var a;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.axios.post(c._20,{page_hash:"drillManagement"});case 2:1==(a=t.sent).data.code?e.hash=a.data.data:e.$message({showClose:!0,message:a.data.msg,type:"error"});case 4:case"end":return t.stop()}},t,e)}))()},drillGetList:function(){var e=this;return o()(n.a.mark(function t(){var a,i;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={keyword:e.formInline.keyword,scene:e.formInline.scene,curr:e.page,pageSize:e.pageSize},t.next=3,e.axios.post(c.S,a);case 3:1==(i=t.sent).data.code?(e.total=i.data.data.total,e.tableData=i.data.data.data):e.$message({showClose:!0,message:i.data.msg,type:"error"});case 5:case"end":return t.stop()}},t,e)}))()},reset:function(){var e=this;this.formInline={name:"",scene:""},this.$nextTick(function(){e.$refs.formInline.resetFields()}),this.drillGetList()},addMan:function(){localStorage.removeItem("Rehearsal_Id"),localStorage.setItem("type","add"),this.$router.push({name:"drillManAdd"})},handleClickDel:function(e){var t=this;this.getHash(),this.$confirm("是否确定删除该设备","删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(o()(n.a.mark(function a(){var i;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i={XDEBUG_SESSION_START:t.xdebug,id:e.toString(),hash:t.hash},a.next=3,t.axios.post(c._153,i).then(function(e){1==e.data.code?(t.$notify.success({showClose:!0,message:e.data.msg,type:"success"}),t.drillGetList()):t.$notify.error({title:"失败",message:e.data.msg})});case 3:a.sent;case 4:case"end":return a.stop()}},a,t)}))).catch(function(e){t.$notify.error({title:"失败",message:"取消操作"})})},getInfo:function(e){var t=this;return o()(n.a.mark(function a(){var i,r;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return i={XDEBUG_SESSION_START:t.xdebug,id:e.id},a.next=3,t.axios.post(c._152,i);case 3:1==(r=a.sent).data.code?t.ruleForm=r.data.data:t.$message({showClose:!0,message:r.data.msg,type:"error"});case 5:case"end":return a.stop()}},a,t)}))()},viewTask:function(e){this.title="查看任务",this.checked=!0,this.centerDialogVisible=!0,this.resetForm(),this.getInfo(e)},resetForm:function(){var e=this;this.ruleForm={id:"",list:[{user_id:"",task:""}],scene:"",scene_name:"",title:""},this.$nextTick(function(){e.$refs.ruleForm.resetFields()})},handleClickEdit:function(e){var t=this;return o()(n.a.mark(function a(){return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:localStorage.setItem("Rehearsal_Id",r()(e.id)),localStorage.setItem("type","edit"),t.$router.push({name:"drillManAdd",params:{id:e.id}});case 3:case"end":return a.stop()}},a,t)}))()}}},d={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("div",{staticClass:"drillManagement"},[a("div",{staticClass:"searchA"},[a("el-input",{attrs:{size:"small",clearable:"",placeholder:"请输入演练名称"},model:{value:e.formInline.keyword,callback:function(t){e.$set(e.formInline,"keyword",t)},expression:"formInline.keyword"}}),e._v(" "),a("el-select",{attrs:{size:"small",clearable:"",placeholder:"请选择场景"},model:{value:e.formInline.scene,callback:function(t){e.$set(e.formInline,"scene",t)},expression:"formInline.scene"}},e._l(e.drillList,function(e){return a("el-option",{key:e.dictionary_value,attrs:{label:e.dictionary_name,value:e.dictionary_value}})}),1),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.search()}}},[e._v("查询")]),e._v(" "),a("div",{staticClass:"add"},[a("el-button",{attrs:{size:"small",type:"primary",icon:""},on:{click:e.addMan}},[e._v("新增演练")])],1)],1),e._v(" "),a("div",{staticClass:"home_table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","element-loading-background":"rgba(0, 0, 0, 0.4)","max-height":e.tableHeight,size:"medium"}},[e._l(e.tableHead,function(t,i){return["people"==t.prop?a("el-table-column",{key:i,attrs:{prop:t.prop,label:t.title,"min-width":t.minWidth,"show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{underline:!1,target:"_blank",type:"primary"},on:{click:function(a){return e.peopleClick(t.row)}}},[e._v("查看任务")])]}}],null,!0)}):"operation"==t.prop?a("el-table-column",{key:i,attrs:{prop:t.prop,label:t.title,"min-width":t.minWidth,"show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{style:{color:1==t.row.status?"#ff2b2b":""},attrs:{underline:!1,target:"_blank",type:"primary"},on:{click:function(a){return e.operationClick(t.row)}}},[e._v(e._s(0==t.row.status?"开始演练":"停止演练"))])]}}],null,!0)}):a("el-table-column",{key:i,attrs:{prop:t.prop,label:t.title,"min-width":t.minWidth,"show-overflow-tooltip":!0}})]}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleClickEdit(t.row)}}},[e._v("编辑")]),e._v(" "),a("el-button",{staticStyle:{color:"#ff2b2b"},attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleClickDel(t.row.id)}}},[e._v("删除")])]}}])})],2)],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{staticClass:"pagination",attrs:{background:"","current-page":e.page,"page-sizes":[15,30,50,100],"page-size":e.pageSize,layout:"prev, pager, next, sizes,total",total:e.total,"hide-on-single-page":e.total<15},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1)]),e._v(" "),a("el-dialog",{attrs:{title:e.title,visible:e.centerDialogVisible,width:"60%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,disabled:e.checked,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"演练名称",prop:"title"}},[a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入演练名称"},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1),e._v(" "),e._l(e.ruleForm.list,function(t){return a("el-form-item",{key:t.id,attrs:{label:"人员任务",rules:e.rules}},[a("el-select",{attrs:{placeholder:"请选择人员"},model:{value:t.real_name,callback:function(a){e.$set(t,"real_name",a)},expression:"item.real_name"}},[a("el-option",{attrs:{label:"正常演练",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"地震预警",value:"2"}})],1),e._v(" "),a("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"请输入人员任务内容"},model:{value:t.task,callback:function(a){e.$set(t,"task",a)},expression:"item.task"}}),e._v(" "),a("el-button",{attrs:{type:"primary",plain:""},on:{click:function(t){return t.preventDefault(),e.removeDomain(e.domain)}}},[e._v("删除")])],1)}),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",plain:""},on:{click:e.addDomain}},[e._v("添加")])],1),e._v(" "),a("el-form-item",{attrs:{label:"场景",prop:"scene_name"}},[a("el-select",{attrs:{placeholder:"请选择场景"},model:{value:e.ruleForm.scene_name,callback:function(t){e.$set(e.ruleForm,"scene_name",t)},expression:"ruleForm.scene_name"}},[a("el-option",{attrs:{label:"正常演练",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"地政预警",value:"2"}})],1)],1),e._v(" "),e.checked?e._e():a("el-form-item",{staticStyle:{"text-align":"right","margin-right":"20px"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.centerDialogVisible=!1}}},[e._v("取消")])],1)],2)],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{title:"人员任务",visible:e.dialogVisible,width:"700px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"home_table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableDataTask,border:"","element-loading-background":"rgba(0, 0, 0, 0.4)","max-height":e.tableHeight,size:"medium"}},[e._l(e.tableHeadTask,function(t,i){return["status"==t.prop?a("el-table-column",{key:i,attrs:{prop:t.prop,align:"center",label:t.title,"min-width":t.minWidth,"show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                            "+e._s(1==t.row.status?"已确定":"未确定")+"\n                        ")]}}],null,!0)}):a("el-table-column",{key:i,attrs:{prop:t.prop,align:"center",label:t.title,"min-width":t.minWidth,"show-overflow-tooltip":!0}})]})],2)],1)])],1)},staticRenderFns:[]};var p=a("VU/8")(u,d,!1,function(e){a("iuJe")},"data-v-aa60e558",null);t.default=p.exports},iuJe:function(e,t){}});
//# sourceMappingURL=25.eb6fa59f2dbd33bedb13.js.map