webpackJsonp([49],{qm5W:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=a("Xxa5"),i=a.n(s),n=a("exGp"),r=a.n(n),o=a("mvHQ"),l=a.n(o),c=a("gyMJ"),d={name:"deckArrangement",data:function(){return{total:0,page:1,pageSize:10,rehearsal_id:"",tableData:[],tableHeight:window.innerHeight-180,tableHead:[{title:"序号",prop:"id",width:"90"},{title:"设备名称",prop:"device_name",minWidth:"120"},{title:"设备所在位置",prop:"location_name",minWidth:"120"}],disabled:!1,title:"",hash:"",centerDialogVisible:!1,centerDialogVisibleEit:!1,ruleForm:{name:"",region:""},rules:{name:[{required:!0,message:"请输入活动名称",trigger:"blur"},{min:3,max:5,message:"长度在 3 到 5 个字符",trigger:"blur"}],region:[{required:!0,message:"请选择活动区域",trigger:"change"}]},value:[],fileList:[],centerDialogVisiblePhotoImg:!1,multipleSelection:[],baseUrl:"",dialogVisible:!1,showTypeList:[],showTitle:"选择图片",previewData:[],showTypeVisible:!1,keyword:"",showNodeData:[],screen:[],screenVisible:!1,isSelectAll:!1,nodeData:[],defaultProps:{children:"children",label:"device_name"},tableHeadCopy:[]}},mounted:function(){this.baseUrl="http://xwcs.xyruxue.com/",localStorage.getItem("Rehearsal_Id")&&this.getlist(),this.resView(),this.getHash(),this.tableHeadCopy=JSON.parse(l()(this.tableHead))},methods:{handleSizeChange:function(e){this.page=1,this.pageSize=e,this.getlist()},handleCurrentChange:function(e){this.page=e,this.getlist()},backDrill:function(){this.$router.push({name:"drillManagement"})},selectAll:function(){this.isSelectAll?this.$refs.tree.setCheckedNodes(this.nodeData):this.$refs.tree.setCheckedNodes([])},screenClick:function(){var e=this;this.resView(),this.screenVisible=!0,this.isSelectAll=!1,this.$nextTick(function(){e.screen.length>0&&e.getNodeData(e.screen)})},screenSubmit:function(){this.screen=this.$refs.tree.getCheckedKeys().concat(this.$refs.tree.getHalfCheckedKeys()),this.screenVisible=!1},getInfo:function(e){var t=this;return r()(i.a.mark(function a(){var s;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.axios.post(c._137,{id:e});case 2:1==(s=a.sent).data.code?(t.ruleForm=s.data.data,t.device_ids=s.data.data.list,t.screen=s.data.data.list,t.resView()):t.$message({showClose:!0,message:s.data.msg,type:"error"});case 4:case"end":return a.stop()}},a,t)}))()},resView:function(){var e=this;return r()(i.a.mark(function t(){var a,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={device_type:"6",title:e.keyword},t.next=3,e.axios.post(c._0,a);case 3:1==(s=t.sent).data.code?(e.nodeData=s.data.data.device_list,e.showNodeData="[object Object]"===Object.prototype.toString.call(s.data.data.file_list)?s.data.data.file_list.data:[],e.showTypeList=s.data.data.show_type_list):e.$message({showClose:!0,message:s.data.msg,type:"error"});case 5:case"end":return t.stop()}},t,e)}))()},getNodeData:function(e){var t=this;return r()(i.a.mark(function a(){var s,n,r;return i.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.nodeData=[],s={device_type:"6",title:t.keyword},a.next=4,t.axios.post(c._0,s);case 4:1==(n=a.sent).data.code?(t.nodeData=n.data.data.device_list,e?t.$nextTick(function(){var t=this;this.$refs.tree.setCheckedKeys([]),e.forEach(function(e){var a=t.$refs.tree.getNode(e);a&&t.$refs.tree.setChecked(a,!0)})}):(r=[],t.nodeData.forEach(function(e){r.push(e.device_id),e.children&&e.children.forEach(function(e){r.push(e.device_id)})}),t.$nextTick(function(){this.$refs.tree.setCheckedKeys(r)}))):t.$message({showClose:!0,message:n.data.msg,type:"error"});case 6:case"end":return a.stop()}},a,t)}))()},getlist:function(){var e=this;return r()(i.a.mark(function t(){var a,s;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={rehearsal_id:JSON.parse(localStorage.getItem("Rehearsal_Id")),curr:e.page,pageSize:e.pageSize},t.next=3,e.axios.post(c._138,a);case 3:1==(s=t.sent).data.code?(e.total=s.data.data.total,e.tableData=s.data.data.data):e.$message({showClose:!0,message:s.data.msg,type:"error"});case 5:case"end":return t.stop()}},t,e)}))()},getHash:function(){var e=this;return r()(i.a.mark(function t(){var a;return i.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.axios.post(c._20,{page_hash:"switchMent"});case 2:1==(a=t.sent).data.code?e.hash=a.data.data:e.$message({showClose:!0,message:a.data.msg,type:"error"});case 4:case"end":return t.stop()}},t,e)}))()},resetForm:function(){var e=this;this.ruleForm={scene_name:"",title:""},this.$nextTick(function(){e.$refs.ruleForm.resetFields()})},banpaiAdd:function(){this.title="新增预警灯配置",this.dialogVisible=!0,this.resetForm()},handleEit:function(e){var t=this;this.title="编辑预警灯配置",this.infoId=e.id,this.dialogVisible=!0,this.resetForm(),this.$nextTick(function(){t.getInfo(e.id)})},handleClickDel:function(e){var t=this;this.$confirm("是否确定进行删除","删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={id:e,hash:t.hash};t.axios.post(c._135,a).then(function(e){1==e.data.code?(t.$notify.success({showClose:!0,message:e.data.msg,type:"success"}),(t.total-1)%t.pageSize==0&&t.total>1&&(t.page-=1),t.getlist()):t.$notify.error({title:"失败",message:e.data.msg})});t.getHash()}).catch(function(e){})},submitForm:function(){var e,t=this;this.$refs.ruleForm.validate((e=r()(i.a.mark(function e(a){var s,n,r,o,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=16;break}return e.next=3,t.getHash();case 3:return s=new RegExp(/^[0-9]*$/),n=[],t.screen.forEach(function(e){s.test(e)&&n.push(e)}),r={rehearsal_id:JSON.parse(localStorage.getItem("Rehearsal_Id")),device_ids:n.join(","),hash:t.hash},o=void 0,void 0!==t.infoId?(o=c._136,r.id=t.infoId):o=c._134,e.next=12,t.axios.post(o,r);case 12:1==(l=e.sent).data.code?(t.$message({showClose:!0,message:l.data.msg,type:"success"}),t.dialogVisible=!1):t.$message({showClose:!0,message:l.data.msg,type:"error"}),t.getlist(),t.getHash();case 16:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))}}},h={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("div",{staticClass:"deckArrangement"},[a("el-button",{staticStyle:{margin:"20px 10px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return t.preventDefault(),e.banpaiAdd.apply(null,arguments)}}},[e._v("新增预警灯配置")]),e._v(" "),a("div",[e._v("\n            已选设备\n        ")]),e._v(" "),a("div",{staticClass:"home_table"},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","element-loading-background":"rgba(0, 0, 0, 0.4)","max-height":e.tableHeight,size:"medium"}},[e._l(e.tableHead,function(e,t){return[a("el-table-column",{key:t,attrs:{prop:e.prop,align:"center",label:e.title,width:e.width,"min-width":e.minWidth,"show-overflow-tooltip":!0}})]}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"操作",fixed:"right",width:"120"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticStyle:{color:"#ff2b2b"},attrs:{type:"text",size:"small"},on:{click:function(a){return e.handleClickDel(t.row.id)}}},[e._v("删除")])]}}])})],2)],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{staticClass:"pagination",attrs:{background:"","current-page":e.page,"page-sizes":[10,20,30,50],"page-size":e.pageSize,layout:"prev, pager, next, sizes,total",total:e.total,"hide-on-single-page":e.total<10},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{attrs:{title:e.title,visible:e.dialogVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:function(t){e.dialogVisible=!1}}},[a("el-form",{ref:"ruleForm",staticClass:"demo-ruleForm",attrs:{model:e.ruleForm,rules:e.rules,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"设备选择"}},[a("el-button",{on:{click:e.screenClick}},[e._v("设备选择")])],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确 定")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"选择设备",visible:e.screenVisible,width:"30%","close-on-click-modal":!1},on:{"update:visible":function(t){e.screenVisible=t},close:function(t){e.screenVisible=!1}}},[a("el-form",[a("el-form-item",{staticStyle:{display:"block"}},[a("el-checkbox",{on:{change:e.selectAll},model:{value:e.isSelectAll,callback:function(t){e.isSelectAll=t},expression:"isSelectAll"}},[e._v("全选/全不选")]),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.nodeData,"show-checkbox":"","check-on-click-node":"","node-key":"device_id",props:e.defaultProps}})],1),e._v(" "),a("el-form-item",[a("el-button",{on:{click:e.screenSubmit}},[e._v("提交")])],1)],1)],1)],1)])},staticRenderFns:[]};var u=a("VU/8")(d,h,!1,function(e){a("tJzY")},"data-v-8837a094",null);t.default=u.exports},tJzY:function(e,t){}});
//# sourceMappingURL=49.cba0cae2a4e7680295fe.js.map