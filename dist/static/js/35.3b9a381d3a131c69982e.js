webpackJsonp([35],{"+Hzy":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("Xxa5"),s=a.n(i),r=a("exGp"),n=a.n(r),o=a("gyMJ"),l={data:function(){return{total:0,page:1,pageSize:15,isLoading:!1,tableHeight:window.innerHeight-180,formData:{title:"",frequency:"",file_id:"",appoint_time:""},title:"",dialogVisible:!1,rule:{title:[{required:!0,message:"请输入铃声名称",trigger:"blur"}],frequency:[{required:!0,message:"请输入播放次数",trigger:"blur"},{type:"number",message:"请输入大于零的整数"}],file_id:[{required:!0,message:"请选择铃声音乐",trigger:"change"}]},tableHead:[{title:"序号",prop:"id",minWidth:"80"},{title:"铃声名称",prop:"title",minWidth:"160"},{title:"铃声时长",prop:"duration",minWidth:"100"},{title:"播放次数",prop:"frequency",minWidth:"80"},{title:"铃声预览",prop:"file",minWidth:"150"},{title:"设备选择",prop:"device_name",minWidth:"100"},{title:"创建时间",prop:"create_time",minWidth:"100"},{title:"预约播放",prop:"appoint_time",minWidth:"100"}],tableData:[],hash:"",listId:"",resources:{},grade_auth:!1,keyword:"",baseUrl:"",nodeData:[],defaultProps:{children:"children",label:"device_name"},fileData:[],loadings:!1,previewData:{},fileID:"",disable:!1}},mounted:function(){this.baseUrl="http://xwcs.xyruxue.com/",this.getList(),this.getHash(),this.resView()},methods:{timeChange:function(e){console.log(null===e),null!==e?(this.disable=!0,this.formData.frequency=1):this.disable=!1},serchList:function(){this.page=1,this.pageSize=15,this.getList()},handleSizeChange:function(e){this.page=1,this.pageSize=e,this.getList()},handleCurrentChange:function(e){this.page=e,this.getList()},fileChange:function(){var e=this;String(this.formData.file_id).length>0&&this.fileData.forEach(function(t){t.id==e.formData.file_id&&(e.previewData={title:t.title,path:t.file_path,duration:t.duration})})},getHash:function(){var e=this;return n()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.axios.post(o._20,{page_hash:"temporaryRingtone"});case 2:1==(a=t.sent).data.code?e.hash=a.data.data:e.$message({showClose:!0,message:a.data.msg,type:"error"});case 4:case"end":return t.stop()}},t,e)}))()},getNodeData:function(e){var t=this;return n()(s.a.mark(function a(){var i,r;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return t.nodeData=[],a.next=3,t.axios.post(o._146);case 3:1==(i=a.sent).data.code?(t.nodeData=i.data.data.device_list,e?t.$nextTick(function(){var t=this;this.$refs.tree.setCheckedKeys([]),e.forEach(function(e){var a=t.$refs.tree.getNode(e);a&&t.$refs.tree.setChecked(a,!0)})}):(r=[],t.nodeData.forEach(function(e){r.push(e.device_id),e.children&&e.children.forEach(function(e){r.push(e.device_id)})}),t.$nextTick(function(){this.$refs.tree.setCheckedKeys(r)}))):t.$message({showClose:!0,message:i.data.msg,type:"error"});case 5:case"end":return a.stop()}},a,t)}))()},resView:function(){var e=this;return n()(s.a.mark(function t(){var a;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.axios.post(o._146);case 2:1==(a=t.sent).data.code?(e.nodeData=a.data.data.device_list,e.fileData=a.data.data.file_list):e.$message({showClose:!0,message:a.data.msg,type:"error"});case 4:case"end":return t.stop()}},t,e)}))()},getList:function(){var e=this;return n()(s.a.mark(function t(){var a,i;return s.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a={curr:e.page,pageSize:e.pageSize,keyword:e.keyword},t.next=3,e.axios.post(o._144,a);case 3:1==(i=t.sent).data.code?(e.total=i.data.data.total,e.tableData=i.data.data.data,i.data.data.data.forEach(function(e){0==e.appoint_status?0==e.status?e.playState=0:1==e.status&&(e.playState=1):1==e.appoint_status?e.playState=2:2==e.appoint_status?e.playState=3:3==e.appoint_status&&(e.playState=4)})):e.$message({showClose:!0,message:i.data.msg,type:"error"});case 5:case"end":return t.stop()}},t,e)}))()},addBtn:function(){this.title="新增临时铃声",this.resView(),this.dialogVisible=!0,this.resetForm()},editBtn:function(e){this.title="编辑临时铃声",this.dialogVisible=!0,this.resetForm(),this.getInfo(e.id)},resetForm:function(){var e=this;this.formData={title:"",frequency:"",file_id:"",appoint_time:""},this.previewData={},this.$nextTick(function(){e.$refs.formData.resetFields()})},getInfo:function(e){var t=this;return n()(s.a.mark(function a(){var i,r;return s.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,t.axios.post(o._143,{id:e});case 2:1==(i=a.sent).data.code?(t.formData=i.data.data,t.previewData={title:i.data.data.file_data.title,path:i.data.data.file_data.file_path,duration:i.data.data.file_data.duration},r=[],i.data.data.list.forEach(function(e){r.push(e.device_id)}),t.getNodeData(r),t.fileID=i.data.data.file_data.id):t.$message({showClose:!0,message:i.data.msg,type:"error"});case 4:case"end":return a.stop()}},a,t)}))()},submit:function(){var e,t=this;this.$refs.formData.validate((e=n()(s.a.mark(function e(a){var i,r,n,l,c,d;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=20;break}return e.next=3,t.getHash();case 3:if(i=t.$refs.tree.getCheckedKeys().concat(t.$refs.tree.getHalfCheckedKeys()),r=new RegExp(/^[0-9]*$/),n=[],i.forEach(function(e){r.test(e)&&n.push(e)}),!(t.formData.frequency<=0)){e.next=11;break}return t.$message({showClose:!0,message:"临时播放时次数为正整数",type:"error"}),e.abrupt("return");case 11:return l={title:t.formData.title,frequency:t.formData.frequency,file_id:t.formData.file_id,device_ids:n.join(","),appoint_time:t.formData.appoint_time,hash:t.hash},c=void 0,"新增临时铃声"==t.title?c=o._140:(c=o._142,l.id=t.formData.id),e.next=16,t.axios.post(c,l);case 16:1==(d=e.sent).data.code?(t.$message({showClose:!0,message:d.data.msg,type:"success"}),t.dialogVisible=!1):t.$message({showClose:!0,message:d.data.msg,type:"error"}),t.getList(),t.getHash();case 20:case"end":return e.stop()}},e,t)})),function(t){return e.apply(this,arguments)}))},handleClose:function(){this.dialogVisible=!1},stop:function(e,t){var a=this;return n()(s.a.mark(function i(){var r;return s.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.next=2,a.axios.post(o._145,{id:e.id,state:t,hash:a.hash});case 2:1==(r=i.sent).data.code?a.$message({showClose:!0,message:r.data.msg,type:"success"}):a.$message({showClose:!0,message:r.data.msg,type:"error"}),a.getList(),a.getHash();case 6:case"end":return i.stop()}},i,a)}))()},delBtn:function(e){var t=this;this.$confirm("是否确定删除该铃声任务","删除提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var a={id:e,hash:t.hash};t.axios.post(o._141,a).then(function(e){1==e.data.code?(t.$notify.success({showClose:!0,message:e.data.msg,type:"success"}),(t.total-1)%t.pageSize==0&&t.total>1&&(t.page-=1),t.getList()):t.$notify.error({title:"失败",message:e.data.msg})}).catch(function(e){t.$notify.error({title:"失败",message:"取消操作"})});t.getHash()})}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"main"},[a("div",{staticClass:"temporaryRingtone"},[a("div",{staticClass:"searchA"},[a("el-input",{attrs:{placeholder:"请输入铃声名称",clearable:"",size:"small"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}}),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary",plain:"",icon:"el-icon-search"},on:{click:function(t){return e.serchList()}}},[e._v("查询")]),e._v(" "),a("div",{staticClass:"add"},[a("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus"},on:{click:e.addBtn}},[e._v("新增临时播放")])],1)],1),e._v(" "),a("div",{staticClass:"home_table"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.isLoading,expression:"isLoading"}],staticStyle:{width:"100%"},attrs:{data:e.tableData,border:"","element-loading-background":"rgba(0, 0, 0, 0.4)","max-height":e.tableHeight,size:"medium"}},[e._l(e.tableHead,function(t,i){return["file"!=t.prop?a("el-table-column",{key:i,attrs:{prop:t.prop,align:"center",label:t.title,"min-width":t.minWidth,"show-overflow-tooltip":!0}}):a("el-table-column",{key:i,attrs:{prop:t.prop,align:"center",label:t.title,"min-width":t.minWidth,"show-overflow-tooltip":!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-link",{attrs:{underline:!1,target:"_blank",type:"primary",href:e.baseUrl+t.row.file_path}},[e._v(e._s(t.row.file_name))])]}}],null,!0)})]}),e._v(" "),a("el-table-column",{attrs:{prop:"address",label:"操作",fixed:"right",width:"180"},scopedSlots:e._u([{key:"default",fn:function(t){return[0==t.row.playState?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.stop(t.row,1)}}},[e._v("开始播放")]):e._e(),e._v(" "),1==t.row.playState||3==t.row.playState?a("el-button",{staticStyle:{color:"#ff2b2b"},attrs:{type:"text",size:"small"},on:{click:function(a){return e.stop(t.row,0)}}},[e._v("停止播放")]):e._e(),e._v(" "),0==t.row.playState||2==t.row.playState?a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(a){return e.editBtn(t.row)}}},[e._v("编辑")]):e._e(),e._v(" "),0==t.row.playState||2==t.row.playState||4==t.row.playState?a("el-button",{staticStyle:{color:"#ff2b2b"},attrs:{type:"text",size:"small"},on:{click:function(a){return e.delBtn(t.row.id)}}},[e._v("删除")]):e._e()]}}])})],2)],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{staticClass:"pagination",attrs:{background:"","current-page":e.page,"page-sizes":[15,30,50,100],"page-size":e.pageSize,layout:"prev, pager, next, sizes,total",total:e.total,"hide-on-single-page":e.total<15},on:{"update:currentPage":function(t){e.page=t},"update:current-page":function(t){e.page=t},"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"dialog",attrs:{title:e.title,visible:e.dialogVisible,width:"600px","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t},close:e.handleClose}},[a("el-form",{ref:"formData",attrs:{model:e.formData,rules:e.rule,"label-width":"110px"}},[a("el-form-item",{attrs:{label:"铃声名称",prop:"title"}},[a("el-input",{attrs:{placeholder:"请输入铃声名称"},model:{value:e.formData.title,callback:function(t){e.$set(e.formData,"title","string"==typeof t?t.trim():t)},expression:"formData.title"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"播放次数",prop:"frequency"}},[a("el-input",{attrs:{disabled:e.disable,placeholder:"请输入播放次数"},model:{value:e.formData.frequency,callback:function(t){e.$set(e.formData,"frequency",e._n(t))},expression:"formData.frequency"}})],1),e._v(" "),a("el-form-item",{staticStyle:{display:"block"},attrs:{label:"设备选择"}},[a("el-tree",{ref:"tree",attrs:{data:e.nodeData,"show-checkbox":"","check-on-click-node":"","node-key":"device_id",props:e.defaultProps}})],1),e._v(" "),a("el-form-item",{attrs:{label:"铃声音乐",prop:"file_id"}},[a("el-select",{ref:"select",attrs:{filterable:"",clearable:""},on:{change:e.fileChange},model:{value:e.formData.file_id,callback:function(t){e.$set(e.formData,"file_id",t)},expression:"formData.file_id"}},e._l(e.fileData,function(e){return a("el-option",{key:e.id,attrs:{label:e.title,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"铃声预览"}},[e.previewData.title?a("el-link",{attrs:{underline:!1,target:"_blank",type:"primary",href:e.baseUrl+e.previewData.path}},[e._v(e._s(e.previewData.title)+"----"+e._s(e.previewData.duration)+"\n                    ")]):e._e()],1),e._v(" "),a("el-form-item",{attrs:{label:"预约播放",prop:"appoint_time"}},[a("el-date-picker",{attrs:{format:"yyyy-MM-dd HH:mm:ss","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime",placeholder:"选择日期时间"},on:{change:e.timeChange},model:{value:e.formData.appoint_time,callback:function(t){e.$set(e.formData,"appoint_time",t)},expression:"formData.appoint_time"}})],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.submit}},[e._v("确 定")])],1)],1)],1)])},staticRenderFns:[]};var d=a("VU/8")(l,c,!1,function(e){a("t6yx")},"data-v-3bbe7004",null);t.default=d.exports},t6yx:function(e,t){}});
//# sourceMappingURL=35.3b9a381d3a131c69982e.js.map