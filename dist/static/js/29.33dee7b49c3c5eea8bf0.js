webpackJsonp([29],{"8ZNE":function(a,e){},Scbf:function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s,r=t("bOdI"),i=t.n(r),n=t("Xxa5"),o=t.n(n),d=t("exGp"),l=t.n(d),c=t("gyMJ"),m={data:function(){return{title:"",dialogVisible:!1,switchVal:!0,tableHead:[{title:"编号",prop:"id",width:"100"},{title:"登录账号",prop:"user_name",minwidth:"150"},{title:"姓名",prop:"real_name",minwidth:"100"},{title:"手机号",prop:"mobile",minwidth:"150"},{title:"状态",prop:"disabled"}],tableData:[],nodeData:[],infoData:[],hasNodes:[],defaultProps:{children:"children",label:"node_name",disabled:"defaulted"},isLoading:!1,dataForm:{id:0,user_name:"",password:"",real_name:"",mobile:"",main_account:!0,disabled:!0},method_auth:{actAdd:0,actEdit:0,actDelete:0,setState:0},main_account:!0,disabled:!0,main_auth:0,total:0,curr:1,hash:"",tableHeight:window.innerHeight-180,pageSize:15,rules:{user_name:[{required:!0,message:"请输入登录手机号码",trigger:"blur"},{required:!0,pattern:/^1\d{10}$/,message:"手机号格式错误",trigger:"blur"}],real_name:[{required:!0,message:"请输入真实姓名",trigger:"blur"}],mobile:[{required:!0,message:"请输入手机号",trigger:"blur"},{required:!0,pattern:/^1\d{10}$/,message:"手机号格式错误",trigger:"blur"}],password:[{min:6,message:"密码必须大于6位",trigger:"blur"}]}}},mounted:function(){this.getList(),this.getHash()},methods:(s={handleSizeChange:function(a){console.log(a),this.curr=1,this.pageSize=a,this.getList()},handleCurrentChange:function(a){this.curr=a,this.getList()},getList:function(){var a=this;return l()(o.a.mark(function e(){var t,s,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a.isLoading=!0,e.next=3,a.axios.post(c.x,{curr:a.curr,pagesize:a.pageSize});case 3:1==(t=e.sent).data.code?(a.tableData=t.data.data.data,a.total=t.data.data.total,s=t.data.data.resources,r=a.method_auth,a.main_auth=t.data.data.resources.main_auth.main_account,s.method_auth.map(function(a){a.method_name&&(r[a.method_name]=a.exist)}),a.method_auth=r,a.isLoading=!1):(a.isLoading=!1,a.$message({showClose:!0,message:t.data.msg,type:"error"}));case 5:case"end":return e.stop()}},e,a)}))()},resetForm:function(){this.dataForm={id:0,user_name:"",password:"",real_name:"",mobile:"",main_account:!0,disabled:!0}},addBtn:function(){var a=this;this.title="新增",this.dialogVisible=!0,this.$nextTick(function(){a.resetForm(),a.$refs.dataForm.clearValidate()}),this.getNodeData()},createData:function(){var a,e=this;this.$refs.dataForm.validate((a=l()(o.a.mark(function a(t){var s,r;return o.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(!t){a.next=11;break}return a.next=3,e.getHash();case 3:return 1==e.dataForm.main_account?e.main_account=1:e.main_account=0,1==e.dataForm.disabled?e.disabled=0:e.disabled=1,s={user_name:e.dataForm.user_name,password:e.dataForm.password,real_name:e.dataForm.real_name,mobile:e.dataForm.mobile,main_account:e.main_account,disabled:e.disabled,node_ids:e.$refs.tree.getCheckedKeys().concat(e.$refs.tree.getHalfCheckedKeys()).join(","),hash:e.hash},a.next=8,e.axios.post(c.t,s);case 8:1==(r=a.sent).data.code?(e.dialogVisible=!1,e.getList(),e.$message({message:r.data.msg,type:"success"})):e.$message({showClose:!0,message:r.data.msg,type:"error"}),e.getHash();case 11:case"end":return a.stop()}},a,e)})),function(e){return a.apply(this,arguments)}))},updateData:function(){var a=this;return l()(o.a.mark(function e(){return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:a.$refs.dataForm.validate(function(){var e=l()(o.a.mark(function e(t){var s,r;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!t){e.next=9;break}return 1==a.dataForm.main_account?a.main_account=1:a.main_account=0,1==a.dataForm.disabled?a.disabled=0:a.disabled=1,s={id:a.dataForm.id,user_name:a.dataForm.user_name,password:a.dataForm.password,real_name:a.dataForm.real_name,mobile:a.dataForm.mobile,main_account:a.main_account,disabled:a.disabled,node_ids:a.$refs.tree.getCheckedKeys().concat(a.$refs.tree.getHalfCheckedKeys()).join(","),hash:a.hash},e.next=6,a.axios.post(c.v,s);case 6:1==(r=e.sent).data.code?(a.dialogVisible=!1,a.getList(),a.$message({message:r.data.msg,type:"success"})):a.$message({showClose:!0,message:r.data.msg,type:"error"}),a.getHash();case 9:case"end":return e.stop()}},e,a)}));return function(a){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}},e,a)}))()}},i()(s,"resetForm",function(){this.dataForm={user_name:"",real_name:"",password:"",mobile:"",main_account:!0,disabled:!0},this.nodeData=[]}),i()(s,"editBtn",function(a){var e=this;this.dataForm.password="",this.title="编辑",this.dialogVisible=!0,this.$nextTick(function(){e.resetForm(),e.$refs.dataForm.clearValidate()}),this.getInfoData(a.id),this.getHash()}),i()(s,"handleDelete",function(a){var e=this;this.$confirm('是否确认删除账号"'+a.user_name+'"?',"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){var t={id:a.id,deleted:1};e.axios.post(c.u,t).then(function(a){1==a.data.code?(e.$notify.success({title:"成功",message:"删除成功"}),(e.total-1)%e.pageSize==0&&e.total>1&&(e.curr-=1),e.getList()):e.$notify.error({title:"失败",message:a.data.msg})});e.getHash()}).catch(function(a){e.$notify.error({title:"失败",message:a.data.msg})})}),i()(s,"handleClose",function(){this.dialogVisible=!1}),i()(s,"getHash",function(){var a=this;return l()(o.a.mark(function e(){var t,s;return o.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={page_hash:"cityAccount"},e.next=3,a.axios.post(c._20,t);case 3:1==(s=e.sent).data.code?a.hash=s.data.data:a.$message({showClose:!0,message:s.data.msg,type:"error"});case 5:case"end":return e.stop()}},e,a)}))()}),i()(s,"switchChange",function(a,e,t,s){var r=this;return l()(o.a.mark(function i(){var n,d,l,m;return o.a.wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return n=1==t?1:0,"disabled"==e&&(n=0==t?1:0,d=c.y),l={id:a,state:n},i.next=5,r.axios.post(d,l);case 5:1==(m=i.sent).data.code||(r.tableData[s][e]=!t,r.$message({showClose:!0,message:m.data.msg,type:"error"}));case 7:case"end":return i.stop()}},i,r)}))()}),i()(s,"getNodeData",function(a){var e=this;return l()(o.a.mark(function t(){var s,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.nodeData=[],t.next=3,e.axios.post(c.z);case 3:1==(s=t.sent).data.code?(e.nodeData=s.data.data,a&&"编辑"==e.title?e.$nextTick(function(){var e=this;this.$refs.tree.setCheckedKeys([]),a.forEach(function(a){var t=e.$refs.tree.getNode(a);t&&t.isLeaf&&e.$refs.tree.setChecked(t,!0)})}):(r=[],e.nodeData.forEach(function(a){r.push(a.id),a.children&&a.children.forEach(function(a){r.push(a.id)})}),e.$nextTick(function(){this.$refs.tree.setCheckedKeys(r)}))):e.$message({showClose:!0,message:s.data.msg,type:"error"});case 5:case"end":return t.stop()}},t,e)}))()}),i()(s,"getInfoData",function(a){var e=this;return l()(o.a.mark(function t(){var s,r;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.infoData=[],s={id:a},t.next=4,e.axios.post(c.w,s);case 4:1==(r=t.sent).data.code?(e.infoData=r.data.data,e.dataForm.id=r.data.data.id,e.dataForm.user_name=r.data.data.user_name,e.dataForm.real_name=r.data.data.real_name,e.dataForm.mobile=r.data.data.mobile,e.hasNodes=r.data.data.nodes,e.getNodeData(e.hasNodes),1==r.data.data.disabled?e.dataForm.disabled=!1:e.dataForm.disabled=!0,1==r.data.data.main_account?e.dataForm.main_account=!0:e.dataForm.main_account=!1,e.dataForm.password=""):e.$message({showClose:!0,message:r.data.msg,type:"error"});case 6:case"end":return t.stop()}},t,e)}))()}),s)},u={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"main"},[t("div",{staticClass:"cityAccount"},[t("div",{staticClass:"searchA"},[t("div",{staticClass:"add"},[t("el-button",{attrs:{size:"small",type:"primary",icon:"el-icon-plus",disabled:!a.method_auth.actAdd},on:{click:a.addBtn}},[a._v("新增")])],1)]),a._v(" "),t("div",{staticClass:"home_table"},[t("el-table",{directives:[{name:"loading",rawName:"v-loading",value:a.isLoading,expression:"isLoading"}],staticStyle:{width:"100%"},attrs:{data:a.tableData,border:"",size:"medium","element-loading-background":"rgba(0, 0, 0, 0.4)",height:a.tableHeight}},[a._l(a.tableHead,function(e,s){return["状态"==e.title?t("el-table-column",{key:s,attrs:{prop:e.prop,label:e.title,width:"100"},scopedSlots:a._u([{key:"default",fn:function(s){return[t("el-switch",{attrs:{disabled:!a.method_auth.setState},on:{change:function(t){return a.switchChange(s.row.id,e.prop,a.tableData[s.$index][e.prop],s.$index)}},model:{value:a.tableData[s.$index][e.prop],callback:function(t){a.$set(a.tableData[s.$index],e.prop,t)},expression:"tableData[scope.$index][item.prop]"}})]}}],null,!0)}):t("el-table-column",{key:s,attrs:{prop:e.prop,label:e.title,width:e.width,"min-width":e.minwidth,"show-overflow-tooltip":!0}})]}),a._v(" "),t("el-table-column",{attrs:{prop:"address",label:"操作",fixed:"right",width:"150"},scopedSlots:a._u([{key:"default",fn:function(e){return[t("el-button",{attrs:{type:"text",disabled:!a.method_auth.actEdit,size:"small"},on:{click:function(t){return a.editBtn(e.row)}}},[a._v("编辑")]),a._v(" "),t("el-button",{staticStyle:{color:"#ff2b2b"},attrs:{type:"text",size:"small",disabled:!a.method_auth.actDelete},on:{click:function(t){return a.handleDelete(e.row)}}},[a._v("删除")])]}}])})],2)],1),a._v(" "),t("div",{staticClass:"pagination"},[t("el-pagination",{staticClass:"pagination",attrs:{background:"","current-page":a.curr,"page-sizes":[15,30,50,100],"page-size":a.pageSize,layout:"prev, pager, next, sizes, total",total:a.total,"hide-on-single-page":a.total<15},on:{"update:currentPage":function(e){a.curr=e},"update:current-page":function(e){a.curr=e},"size-change":a.handleSizeChange,"current-change":a.handleCurrentChange}})],1),a._v(" "),a.dialogVisible?t("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],staticClass:"dialogStyle",attrs:{title:a.title,visible:a.dialogVisible,width:"500px","close-on-click-modal":!1},on:{"update:visible":function(e){a.dialogVisible=e},close:a.handleClose}},[t("el-form",{ref:"dataForm",attrs:{rules:a.rules,model:a.dataForm,"status-icon":"","label-position":"top","label-width":"100px",inline:!0}},[t("el-form-item",{attrs:{label:"登录账号",prop:"user_name"}},[t("el-input",{attrs:{placeholder:"请输入登录手机号码",size:"small",maxlength:"11"},model:{value:a.dataForm.user_name,callback:function(e){a.$set(a.dataForm,"user_name",e)},expression:"dataForm.user_name"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"姓名",prop:"real_name"}},[t("el-input",{attrs:{placeholder:"请输入姓名",size:"small"},model:{value:a.dataForm.real_name,callback:function(e){a.$set(a.dataForm,"real_name",e)},expression:"dataForm.real_name"}})],1),a._v(" "),t("el-form-item",{attrs:{label:"手机号"}},[t("el-input",{attrs:{placeholder:"微信/i襄阳注册手机号",size:"small"},model:{value:a.dataForm.mobile,callback:function(e){a.$set(a.dataForm,"mobile",e)},expression:"dataForm.mobile"}})],1),a._v(" "),"新增"==a.title?t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{placeholder:"请输入密码",size:"small",type:"password"},model:{value:a.dataForm.password,callback:function(e){a.$set(a.dataForm,"password",e)},expression:"dataForm.password"}})],1):t("el-form-item",{attrs:{label:"密码",prop:"password"}},[t("el-input",{attrs:{placeholder:"不修改请留空",size:"small",type:"password"},model:{value:a.dataForm.password,callback:function(e){a.$set(a.dataForm,"password",e)},expression:"dataForm.password"}})],1),a._v(" "),t("el-row",[t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"负责人权限"}},[t("el-switch",{model:{value:a.dataForm.main_account,callback:function(e){a.$set(a.dataForm,"main_account",e)},expression:"dataForm.main_account"}})],1)],1),a._v(" "),t("el-col",{attrs:{span:12}},[t("el-form-item",{attrs:{label:"状态"}},[t("el-switch",{attrs:{disabled:!a.method_auth.setState},model:{value:a.dataForm.disabled,callback:function(e){a.$set(a.dataForm,"disabled",e)},expression:"dataForm.disabled"}})],1)],1)],1),a._v(" "),t("div",{staticClass:"dialogInput"},[t("div",{staticClass:"padd"},[t("div",{staticClass:"paddTit"},[a._v("资源权限")]),a._v(" "),t("div",{staticClass:"tree_main"},[t("el-form-item",{staticStyle:{display:"block"}},[t("el-tree",{ref:"tree",attrs:{data:a.nodeData,"show-checkbox":"","check-on-click-node":"","node-key":"id","default-expand-all":"",props:a.defaultProps}})],1)],1)])])],1),a._v(" "),t("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},["新增"==a.title?t("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:a.createData}},[a._v("确 定")]):t("el-button",{staticClass:"btn",attrs:{type:"primary"},on:{click:function(e){return a.updateData()}}},[a._v("确 定")])],1)],1):a._e()],1)])},staticRenderFns:[]};var p=t("VU/8")(m,u,!1,function(a){t("8ZNE")},"data-v-6fedb81b",null);e.default=p.exports}});
//# sourceMappingURL=29.33dee7b49c3c5eea8bf0.js.map